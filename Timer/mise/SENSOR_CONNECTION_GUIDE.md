# STM32 센서 모니터링 시스템 연결 가이드

## 개요
이 프로젝트는 STM32F411RE를 사용하여 다음 센서들을 3초마다 모니터링합니다:
- 물수위 센서 (ADC) - WATER_LEVEL_SENSOR
- MQ2 가스 감지 센서 (ADC) - MQ2_GAS_SENSOR  
- GP2Y1010AU0F 미세먼지 센서 (ADC) - DUST_SENSOR_ANALOG
- DHT11 온습도 센서 (디지털) - DHT11_TEMP_HUMIDITY
- 미세먼지 센서 LED 제어 - DUST_SENSOR_LED

## 센서 연결 방법

### 1. 물수위 센서 (WATER_LEVEL_SENSOR)
- **핀**: PA0 (ADC1_CH0)
- **전원**: 3.3V 또는 5V
- **GND**: 공통 GND
- **출력**: 아날로그 신호 (0-3.3V 또는 0-5V)

### 2. MQ2 가스 감지 센서 (MQ2_GAS_SENSOR)
- **핀**: PA1 (ADC1_CH1)
- **전원**: 5V 권장
- **GND**: 공통 GND
- **출력**: 아날로그 신호 (0-5V)
- **참고**: 가스 농도에 따라 전압이 변합니다

### 3. GP2Y1010AU0F 미세먼지 센서 (DUST_SENSOR_ANALOG)
- **아날로그 핀**: PA4 (ADC1_CH4)
- **LED 제어 핀**: PA7 (DUST_SENSOR_LED)
- **전원**: 5V (VCC), 3.3V (V-LED)
- **GND**: 공통 GND, S-GND
- **추가 부품**: 150Ω 저항 (LED와 V-LED 사이), 220μF 커패시터 (VCC와 GND 사이)
- **출력**: 아날로그 신호 (0-5V)
- **참고**: LED 제어가 필요한 센서입니다

#### 상세 회로 연결:
```
STM32F411RE                    GP2Y1010AU0F
├── PA4 (ADC1_CH4) ──────────── Vo (아날로그 출력)
├── PA7 (DUST_SENSOR_LED) ───── LED (LED 제어)
├── 5V ──────────────────────── VCC
├── 3.3V ────[150Ω]──────────── V-LED
└── GND ──────────────────────── GND, S-GND

추가 부품:
└── 220μF 커패시터 (VCC와 GND 사이)
```

### 4. DHT11 온습도 센서 (DHT11_TEMP_HUMIDITY)
- **핀**: PA6 (디지털 입출력)
- **전원**: 3.3V 또는 5V
- **GND**: 공통 GND
- **데이터**: 단일 와이어 통신

## 하드웨어 연결도

```
STM32F411RE
├── PA0 ──── 물수위 센서 출력 (WATER_LEVEL_SENSOR)
├── PA1 ──── MQ2 가스센서 출력 (MQ2_GAS_SENSOR)
├── PA4 ──── 미세먼지 센서 출력 (DUST_SENSOR_ANALOG)
├── PA6 ──── DHT11 데이터 핀 (DHT11_TEMP_HUMIDITY)
├── PA7 ──── 미세먼지 센서 LED 제어 (DUST_SENSOR_LED)
├── 3.3V ─── 센서 전원 (일부 센서용)
├── 5V ───── 센서 전원 (MQ2, 미세먼지 센서용)
└── GND ──── 공통 접지
```

## 출력 데이터 형식

시스템은 3초마다 다음 정보를 UART로 출력합니다:

```
=== 센서 데이터 (3초 주기) ===
물수위 센서: 1.234V (ADC: 1523)
MQ2 가스센서: 2.456V (ADC: 3045)
미세먼지 센서: 0.789V (ADC: 978)
미세먼지 농도: 12.34 mg/m³
온도: 25.6°C
습도: 65.2%
==============================
```

## 센서 보정 및 설정

### 물수위 센서
- 센서 타입에 따라 전압-수위 변환 공식을 조정하세요
- 현재 코드는 원시 전압값만 출력합니다

### MQ2 가스 센서
- 가스 타입별로 다른 민감도를 가집니다
- 필요시 전압-가스 농도 변환 공식을 추가하세요

### 미세먼지 센서 (GP2Y1010AU0F)
- 코드에 이미 농도 계산 공식이 포함되어 있습니다
- 센서 특성에 따라 보정이 필요할 수 있습니다

### DHT11 온습도 센서
- 디지털 통신으로 정확한 값을 제공합니다
- 통신 실패 시 이전 값이 유지됩니다

## 컴파일 및 실행

1. STM32CubeIDE에서 프로젝트를 열기
2. 프로젝트 빌드 (Ctrl+B)
3. 타겟 보드에 플래시 및 실행
4. 시리얼 모니터에서 115200 baud로 데이터 확인

## 주의사항

- 센서 전원 공급을 확인하세요
- ADC 입력 전압이 3.3V를 초과하지 않도록 주의하세요
- DHT11 통신 실패 시 재시도 로직이 포함되어 있습니다
- 타이머 인터럽트를 사용하므로 메인 루프가 블록되지 않습니다

## 문제 해결

### 센서 값이 0으로 나오는 경우
- 센서 연결 확인
- 전원 공급 확인
- ADC 채널 설정 확인

### DHT11 통신 실패
- 데이터 핀 연결 확인
- 풀업 저항 확인 (보통 센서에 내장됨)
- 통신 타이밍 확인

### 타이머가 작동하지 않는 경우
- TIM2 클럭 활성화 확인
- 인터럽트 우선순위 설정 확인
